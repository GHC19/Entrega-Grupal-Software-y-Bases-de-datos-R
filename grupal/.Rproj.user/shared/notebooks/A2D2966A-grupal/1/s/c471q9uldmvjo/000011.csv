"0","#| echo: false"
"0","# Crear el diccionario de equivalencias entre denominaciones y siglas"
"0","siglas_diccionario <- abbrev |> "
"0","  select(denominacion, siglas) |> "
"0","  deframe() # Convierte en un vector clave-valor"
"0",""
"0","# Modificar el mutate en navarra_2008 para usar el diccionario"
"0","navarra_2008 <- navarra_2008 |>"
"0","  rowwise() |>"
"0","  mutate("
"0","    partido_ganador = {"
"0","      valores <- c_across(16:25) # Selección por índices de columnas de partidos"
"0","      nombres <- colnames(navarra_2008)[16:25]"
"0","      max_votos <- max(valores, na.rm = TRUE)"
"0","      if (all(valores == 0, na.rm = TRUE)) {"
"0","        ""Sin datos"""
"0","      } else if (sum(valores == max_votos, na.rm = TRUE) > 1) {"
"0","        ""Municipios con empate"""
"0","      } else {"
"0","        nombres[which.max(valores)]"
"0","      }"
"0","    }"
"0","  ) |>"
"0","  ungroup() |>"
"0","  mutate("
"0","    partido_ganador = case_when("
"0","      partido_ganador %in% names(siglas_diccionario) ~ siglas_diccionario[partido_ganador], # Reemplazar con siglas"
"0","      partido_ganador == ""Municipios con empate"" ~ ""Municipios con empate"", # Mantener empates como están"
"0","      TRUE ~ partido_ganador # Dejar sin cambios si no está en el diccionario"
"0","    )"
"0","  )"
"0",""
"0",""
"0","# Unir los datos geoespaciales y calcular nombres corregidos"
"0","mapa_navarra_2008 <- municipios_navarra |>"
"0","  mutate(MUNICIPIO = tolower(MUNICIPIO)) |>"
"0","  left_join("
"0","    navarra_2008 |>"
"0","      mutate("
"0","        municipio = tolower(municipio),"
"0","        municipio = gsub(""/"", "" / "", municipio),"
"0","        municipio = case_when("
"0","          municipio == ""romanzado"" ~ ""romanzado / erromantzatua"","
"0","          municipio == ""urraul alto"" ~ ""urraúl alto"","
"0","          municipio == ""urraul bajo"" ~ ""urraúl bajo"","
"0","          municipio == ""arcos, los"" ~ ""los arcos"","
"0","          municipio == ""busto, el"" ~ ""el busto"","
"0","          municipio == ""pueyo"" ~ ""pueyo / puiu"","
"0","          municipio == ""ucar"" ~ ""úcar"","
"0","          municipio == ""atez / atetz"" ~ ""atetz"","
"0","          municipio == ""olaibar"" ~ ""oláibar"","
"0","          municipio == ""juslapeña"" ~ ""juslapeña / txulapain"","
"0","          municipio == ""lizoáin-arriasgoiti"" ~ ""lizoain-arriasgoiti / lizoainibar-arriasgoiti"","
"0","          municipio == ""saldías"" ~ ""saldias"","
"0","          TRUE ~ municipio"
"0","        )"
"0","      ),"
"0","    by = c(""MUNICIPIO"" = ""municipio"")"
"0","  )"
"0",""
