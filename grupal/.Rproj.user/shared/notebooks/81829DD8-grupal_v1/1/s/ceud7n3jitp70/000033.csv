"0","#| echo: false"
"0","navarra_2008 <- navarra_2008 |>"
"0","  rowwise() |>"
"0","  mutate("
"0","    partido_ganador = {"
"0","      valores <- c_across(16:25) # Selección por índices de columnas"
"0","      nombres <- colnames(navarra_2008)[16:25] # Nombres correspondientes a esas columnas"
"0","      max_votos <- max(valores, na.rm = TRUE) # Asegurar que se ignoren NA"
"0","      "
"0","      if (all(valores == 0, na.rm = TRUE)) {"
"0","        ""Sin datos"" # Si no hay votos"
"0","      } else if (sum(valores == max_votos, na.rm = TRUE) > 1) {"
"0","        # Si hay más de un partido con el máximo número de votos"
"0","        paste(nombres[valores == max_votos], collapse = "", "")"
"0","      } else {"
"0","        # El partido único con el máximo número de votos"
"0","        nombres[which.max(valores)]"
"0","      }"
"0","    }"
"0","  ) |>"
"0","  ungroup()"
"0",""
"0","# Modificar los niveles de `partido_ganador`"
"0","navarra_2008 <- navarra_2008 |>"
"0","  mutate("
"0","    partido_ganador = case_when("
"0","      partido_ganador == ""OTROS"" ~ ""Otros"","
"0","      partido_ganador == ""PARTIDO POPULAR"" ~ ""PP"","
"0","      partido_ganador == ""PARTIDO SOCIALISTA OBRERO ESPAÑOL"" ~ ""PSOE"","
"0","      partido_ganador == ""PARTIDO POPULAR, OTROS"" ~ ""PP/Otros"","
"0","      partido_ganador == ""PARTIDO SOCIALISTA OBRERO ESPAÑOL, PARTIDO POPULAR"" ~ ""PSOE/PP"","
"0","      partido_ganador == ""PARTIDO NACIONALISTA VASCO"" ~ ""EAJ-PNV"","
"0","      TRUE ~ partido_ganador"
"0","    )"
"0","  )"
"0",""
"0",""
"0","navarra_2008 <- navarra_2008 |>"
"0","  mutate(municipio = gsub(""/"", "" / "", municipio)) # Agregar espacios alrededor de '/'"
"0",""
"0","# Corregir los nombres de municipios en navarra_2008"
"0","navarra_2008 <- navarra_2008 |>"
"0","  mutate("
"0","    municipio = case_when("
"0","      municipio == ""romanzado"" ~ ""romanzado / erromantzatua"","
"0","      municipio == ""urraul alto"" ~ ""urraúl alto"","
"0","      municipio == ""urraul bajo"" ~ ""urraúl bajo"","
"0","      municipio == ""arcos, los"" ~ ""los arcos"","
"0","      municipio == ""busto, el"" ~ ""el busto"","
"0","      municipio == ""pueyo"" ~ ""pueyo / puiu"","
"0","      municipio == ""ucar"" ~ ""úcar"","
"0","      municipio == ""atez / atetz"" ~ ""atetz"","
"0","      municipio == ""olaibar"" ~ ""oláibar"", # Agregar tilde a ""olaibar"""
"0","      municipio == ""juslapeña"" ~ ""juslapeña / txulapain"","
"0","      municipio == ""lizoáin-arriasgoiti"" ~ ""lizoain-arriasgoiti / lizoainibar-arriasgoiti"","
"0","      municipio == ""saldías"" ~ ""saldias"","
"0","      TRUE ~ municipio # Mantener el resto de los valores sin cambios"
"0","    )"
"0","  )"
"0","# Unir los datos geoespaciales"
"0","map_data <- municipios_navarra |>"
"0","  left_join(navarra_2008, by = c(""MUNICIPIO"" = ""municipio""))"
"0",""
"0",""
"0",""
"0","# Actualización de los colores"
"0","colores <- c("
"0","  ""Otros"" = ""grey70"","
"0","  ""PP"" = ""#00ADE0"","
"0","  ""PSOE"" = ""#D21B00"","
"0","  ""EAJ-PNV"" = ""#007A45"","
"0","  ""PSOE/PP"" = ""yellow"" # Color amarillo para empate"
"0",")"
"0",""
"0","# Crear el mapa"
"0","ggplot(map_data) +"
"0","  geom_sf(aes(fill = partido_ganador), color = ""black"", size = 0.2) + "
"0","  scale_fill_manual(values = colores, na.value = ""grey80"") +"
"0","  labs("
"0","    title = ""Partido Político Más Votado en Navarra (2008)"","
"0","    subtitle = ""Datos por municipio"","
"0","    fill = ""Partido Ganador"""
"0","  ) +"
"0","  theme_minimal() +"
"0","  theme("
"0","    legend.position = ""bottom"","
"0","    plot.title = element_text(size = 16, face = ""bold""),"
"0","    plot.subtitle = element_text(size = 12),"
"0","    axis.title = element_blank(),  # Eliminar títulos de los ejes"
"0","    axis.text = element_blank(),   # Eliminar textos de los ejes"
"0","    axis.ticks = element_blank(),  # Eliminar marcas de los ejes"
"0","    panel.grid = element_blank()   # Eliminar cuadrícula"
"0","  )"
