"0","# Filtrar las encuestas según los criterios"
"0","surveys_filtered <- surveys |> "
"0","  filter("
"0","    date_elec >= as.Date(""2008-01-01""),  # Elecciones a partir de 2008"
"0","    !exit_poll,  # Excluir encuestas a pie de urna"
"0","    size >= 500,  # Tamaño muestral de al menos 500"
"0","    as.numeric(field_date_to - field_date_from) > 1  # Más de 1 día de trabajo de campo"
"0","  )"
"0",""
"0","# Definir los partidos de interés"
"0","partidos_interes <- c(""PSOE"", ""EAJ-PNV"", ""ERC"", ""EH-BILDU"", ""PP"", ""PODEMOS"", ""CS"", ""BNG"", ""VOX"")"
"0",""
"0","col_inicio_partidos <- 11  # Índice de la primera columna de partidos"
"0","columnas_otros <- setdiff(names(surveys_filtered)[col_inicio_partidos:ncol(surveys_filtered)], partidos_interes)"
"0",""
"0","# Transformar el dataset"
"0","surveys_filtered <- surveys_filtered |> "
"0","  mutate("
"0","    OTROS = rowSums(across(all_of(columnas_otros), ~ replace_na(., 0)), na.rm = TRUE)"
"0","  ) |> "
"0","  select(all_of(partidos_interes), OTROS, everything()) |> select(1:20)"
"0",""
"0","surveys_filtered"
